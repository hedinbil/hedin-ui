@namespace Hedin.UI

<div class="hui-dialog-section">
    <MudDivider />
    <MudExpansionPanels Elevation="0">
        <MudExpansionPanel Expanded="IsExpanded" ExpandedChanged="HandleIsExpandedChanged" ChildContent="ChildContent" TitleContent="TitleContent" />
    </MudExpansionPanels>
</div>

@code {
    /// <summary>
    /// The content to display within the dialog section.
    /// Renders when the section is expanded.
    /// </summary>
    [Parameter] public RenderFragment ChildContent { get; set; }
    
    /// <summary>
    /// Content displayed in the section title bar.
    /// Typically contains the section header text.
    /// </summary>
    [Parameter] public RenderFragment TitleContent { get; set; }
    
    /// <summary>
    /// Controls whether the dialog section is expanded or collapsed.
    /// Determines the visibility of the section content.
    /// </summary>
    [Parameter] public bool IsExpanded { get; set; }
    
    /// <summary>
    /// Event callback when the expansion state changes.
    /// Provides the new expansion state.
    /// </summary>
    [Parameter] public EventCallback<bool> IsExpandedChanged { get; set; }
    
    /// <summary>
    /// Initial expansion state when the component is first rendered.
    /// Overrides IsExpanded if they differ during initialization.
    /// </summary>
    [Parameter] public bool IsInitiallyExpanded { get; set; } = true;

    protected override void OnInitialized()
    {
        //If initially expanded is used and expanded is false, then initially expanded will override IsExpanded
        if(IsInitiallyExpanded && IsInitiallyExpanded != IsExpanded)
        {
            IsExpanded = IsInitiallyExpanded;
            IsExpandedChanged.InvokeAsync(IsExpanded);
        }

        base.OnInitialized();
    }


    private async void HandleIsExpandedChanged(bool expanded)
    {
        IsExpanded = expanded;
        await IsExpandedChanged.InvokeAsync(IsExpanded);
    }
}
