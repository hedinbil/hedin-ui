@namespace Hedin.UI
@inherits MudDialog

<MudDialog DialogContent="base.DialogContent" DialogActions="base.DialogActions" Gutters="base.Gutters" OnBackdropClick="HandleCancelClick" DefaultFocus="DefaultFocus" Class="@base.Class" Style="@base.Style">
    <TitleContent>
        <div class="d-flex justify-space-between">
            <MudText Typo="Typo.h1">@MudDialog!.Title</MudText>
            <span class="d-flex gap-1">
                @TitleButtons
                @if (OnCancelClick.HasDelegate)
                {
                    <HUIIconButton Icon="@Icons.Material.Filled.Close" OnClick="HandleCancelClick" />
                }
            </span>
        </div>
    </TitleContent>
</MudDialog>
<HUIDialogUnsavedChanges IsVisible="ShowUnsavedChanges" IsVisibleChanged="HandleUnsavedChangesToggled" OnCloseWindow="HandleCloseWindowClick"></HUIDialogUnsavedChanges>

@code
{
    /// <summary>
    /// Cascading parameter that provides access to the MudBlazor dialog instance.
    /// Required for dialog functionality and result handling.
    /// </summary>
    [CascadingParameter] IMudDialogInstance? MudDialog { get; set; }
    
    /// <summary>
    /// Event callback when the cancel button is clicked.
    /// Typically used to close the dialog or handle cancellation.
    /// </summary>
    [Parameter] public EventCallback OnCancelClick { get; set; }
    
    /// <summary>
    /// Shows the unsaved changes overlay
    /// </summary>
    [Parameter] public bool ShowUnsavedChanges { get; set; }
    
    /// <summary>
    /// Event callback when the unsaved changes state changes.
    /// Provides the new visibility state for the unsaved changes overlay.
    /// </summary>
    [Parameter] public EventCallback<bool> ShowUnsavedChangesChanged { get; set; }
    
    /// <summary>
    /// Custom buttons to display in the dialog title bar.
    /// Typically used for additional dialog actions or controls.
    /// </summary>
    [Parameter] public RenderFragment? TitleButtons { get; set; }

    private void HandleUnsavedChangesToggled(bool value)
    {
        ShowUnsavedChanges = value;
        ShowUnsavedChangesChanged.InvokeAsync(value);
    }

    private void HandleCancelClick() => OnCancelClick.InvokeAsync();

    private void HandleCloseWindowClick() => MudDialog!.Cancel();
}